@model IEnumerable<Duan_CNPM.Models.AuditLog>
@{
    ViewData["Title"] = "Nhật ký hệ thống";
}

<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-md-12">
            <h2>Nhật ký hệ thống</h2>
        </div>
    </div>

    <div class="card">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover table-sm">
                    <thead>
                        <tr>
                            <th>Thời gian</th>
                            <th>Người dùng</th>
                            <th>Hành động</th>
                            <th>Bảng</th>
                            <th>ID</th>
                            <th>IP</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var log in Model)
                        {
                            <tr>
                                <td>
                                    <small>@log.CreatedDate.ToString("dd/MM/yyyy HH:mm:ss")</small>
                                </td>
                                <td>@(log.UserID?.ToString() ?? "System")</td>
                                <td>
                                    <span class="badge
                                            @(log.Action.Contains("Create") ? "bg-success" :
                                                                                    log.Action.Contains("Update") ? "bg-info" :
                                                                                    log.Action.Contains("Delete") ? "bg-danger" : "bg-secondary")">
                                    @log.Action
                                </span>
                            </td>
                            <td>@log.TableName</td>
                            <td>@log.RecordID</td>
                            <td><small class="text-muted">@log.IPAddress</small></td>
                        </tr>
                                                }
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            <nav class="mt-3">
                <ul class="pagination justify-content-center">
                    @{
                        int currentPage = ViewBag.CurrentPage ?? 1;
                        int totalPages = (int)Math.Ceiling((double)ViewBag.TotalLogs / 50);
                    }

                    @if (currentPage > 1)
                    {
                        <li class="page-item">
                            <a class="page-link" href="?page=@(currentPage - 1)">Trước</a>
                        </li>
                    }

                    @for (int i = Math.Max(1, currentPage - 2); i <= Math.Min(totalPages, currentPage + 2); i++)
                    {
                        <li class="page-item @(i == currentPage ? "active" : "")">
                            <a class="page-link" href="?page=@i">@i</a>
                        </li>
                    }

                    @if (currentPage < totalPages)
                    {
                        <li class="page-item">
                            <a class="page-link" href="?page=@(currentPage + 1)">Sau</a>
                        </li>
                    }
                </ul>
            </nav>
        </div>
    </div>
</div>